<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>

        .playGround {
            position: absolute;
            margin-left: 210px;
            margin-top: 52.5px;
            width: 280px;
            height: 429.5px;
            border: 1px solid yellow;
            z-index: 3;
        }
        .wrapper{
            margin-top: 100px;
			width: 700px;
			height: 504px;
			border: 1px solid red;
			position: relative;
			margin: 0 auto;
			overflow: hidden;
		}
        .arrow {
            /* margin: auto; */
            /* margin-top: 387px; */
            /* margin-left: 332.5px; */

            margin-top: 333px;
            margin-left: 122px;
            position: absolute;
            z-index: 3;
            /* transform: rotate(90deg); */
            
        }
        .bubble {
            margin-top: 585px;
            margin-left: 369px;
            position: absolute;
            z-index: 1;
        }
        .line {
            width: 1px;
            height: 1748px;
            margin-top: -443.5px;
            margin-left: 349.5px;
            border: 1px solid black;
            position: relative;
        }
        .attr {
            position: absolute; top:0; left:0;
            width: 100%;
            height: 100%;
        }
        .blue {
            width: 40px;
            height: 40px;
            margin-top: 358px;
            margin-left: 120.5px;
            z-index: 2;
            position: absolute;
            /* visibility: hidden; */
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <div class="playGround">
            <img src="img/blueBubble.png" alt="" class="blue">
            <img src="img/arrow2.png" alt="" class="arrow">
        </div>

        <img src="img/ATTRACT1.png" alt="" class="attr">
        <img src="img/blueLine4.png" alt="" class="line">
        <!-- <div class="lunchBubble"></div> -->
        
    </div>
    <!-- <canvas id="canvas" class="tutorial" ></canvas> -->
    
<script src="jquery-3.2.0.js"></script>
<script>

// var canvas = document.getElementById('canvas');
// var ctx = canvas.getContext('2d');
// ctx.beginPath();
// ctx.arc(100,100,50,0,(Math.PI/180)*360,false);
// ctx.fillStyle = "rgb(0, 255, 255)";
// ctx.fill();
// ctx.stroke();

var line = $('.line');      // 직선 개체
var arrow = $('.arrow');    // 화살표 개체
var bubble = $('.bubble');  // 버블 개체
var blue = $('.blue');

var nx = 0;

// 버블 각도
var bubbleDeg = 0;

var bSpeed = 5;

$('.wrapper').append('<img src="img/circle3.png" class="bubble">')

// 입력된 키를 담아둘 오브젝트
var keypress={};


function lunch() {
    
    window.onkeydown = function(e) {
        var bubbleY = blue.position().top;
        var bubbleX = blue.position().left;
        var rad = 2*Math.PI*(bubbleDeg/360);    // Radian
        var y = 358*Math.tan(rad);
        var y2 = 121/Math.tan(rad);
        var tan = Math.tan(rad);
        
        // space == 32
        if(e.keyCode==32) {
            var bounce; // 튕기는 횟수
            // 17.63
            if(bubbleDeg>0 && bubbleDeg<=18) bounce = 0;
            if(bubbleDeg>=17.63) bounce = 1;

            // 양수 음수 상태
            var status = false; 
            if(bubbleDeg>=0) status=true;  
            else status = false;
        
            
            if(status) {    // 각도가 양수일 때
                switch(bounce) {
                    case 0: // 0번 팅길때
                        blue.animate({top:-359, left:tan*359})
                        break;
                    case 1: // 1번 팅길때
                        blue.animate({top:-y2, left:121}, function() {
                            blue.animate({top:-359, left:121-((379-y2)*tan)}, function() {
                                console.log('x는말이죠 '+(359-y2)*tan)
                            })
                        })
                        break;
                    case 2: // 2번 팅길 때
                        break;

                }

            } else {    // 각도가 음수 일때
            
            }
            
        }
    }
}

function angleTest() {


    window.onkeyup = function(e) {
        var bubbleY = blue.position().top;
        var bubbleX = blue.position().left;
        console.log('bubbleY :'+bubbleY);
        console.log('bubbleX :'+bubbleX);
        console.log('CurrentKey : '+e.keyCode);
        console.log('Degree : '+bubbleDeg);
        console.log('');

        // 1번 키 입력시 29.74 각도로 이동
        if(e.keyCode==49) {
            console.log('Number 1 press : Go to 20.35 deg')
            console.log('');
            arrow.css('transform', 'rotate(20.35deg)');
            bubble.css('transform', 'rotate(20.35deg)');
            line.css('transform', 'rotate(20.35deg)');
        }

        // 2번 키 입력시 45도 각도로 이동
        if(e.keyCode==50) {
            console.log('Number 2 press : Go to 45 deg')
            console.log('');
            arrow.css('transform', 'rotate(45deg)');
            bubble.css('transform', 'rotate(45deg)');
            line.css('transform', 'rotate(45deg)');
        }

        // 3번 키 입력시 21.39
        if(e.keyCode==51) {
            arrow.css('transform', 'rotate(17.63deg)');
            bubble.css('transform', 'rotate(17.63deg)');
            line.css('transform', 'rotate(17.63deg)');
        }

        // 스페이스바 입력시
        // if(e.keyCode==32) {

        //     // 라디안 변환
        //     var rad = 2*Math.PI*(bubbleDeg/360);

        //     // 밑변의 길이
        //     var x = 800*Math.tan(rad)

        //     // var angle = Math.tan(bubbleDeg)
        //     console.log('rad:'+rad)
        //     console.log('x길이는:'+x);

        //     // blue.animate({top:-100,left:-100})
        // }
    }
}

// 화살표 움직임
function moveArrow() {

    // 오른쪽
    if(keypress['39']) {
        this.nx += 1;
        this.bubbleDeg += 1;                 
        arrow.css('transform', 'rotate('+nx+'deg)');
        bubble.css('transform', 'rotate('+bubbleDeg+'deg)');
        line.css('transform', 'rotate('+bubbleDeg+'deg)');
    }

    // 왼쪽
    if(keypress['37']) {
        this.nx -= 1;
        this.bubbleDeg -= 1;
        arrow.css('transform', 'rotate('+nx+'deg)');
        bubble.css('transform', 'rotate('+bubbleDeg+'deg)');
        line.css('transform', 'rotate('+bubbleDeg+'deg)');
    }

    // if(keypress['32']) {
        
    //     this.bSpeed -=5;
    //     bubble.css('transform', 'translateX('+bSpeed+'px)')
    //     bubble.css('transform', 'translateY('+bSpeed+'px)')
    // }
}


angleTest()
lunch()
setInterval(moveArrow, 10)


$(window).keydown(function(e){ // 어떤 키가 눌렸는지 저장 
    keypress[e.which.toString()] = true;
});
$(window).keyup(function(e){ // 눌렸던 키를 해제
    keypress[e.which.toString()] = false;
});    

</script>
</body>
</html>